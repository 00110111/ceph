# this case tests issue #9419 "dumpling->firefly upgrade, sending setallochint?"
overrides:
  ceph:
    conf:
      mon:
        mon warn on legacy crush tunables: false
    log-whitelist:
      - scrub mismatch
      - ScrubResult
roles:
- - mon.a
  - mds.a
  - osd.0
  - osd.1
- - mon.b
  - mon.c
  - osd.2
  - osd.3
- - client.0
tasks:
- install:
   branch: dumpling
- print: "**** done install dumpling" 
- ceph:
   fs: xfs
- print: "**** done ceph"
- install.upgrade:
    client.0:
- print: "**** done install.upgrade on clinet.0" 
- install.upgrade:
    mon.a:
    mon.b:
- print: "**** done install.upgrade" 
- ceph.restart: 
    #osd.2 is not upgraded
    daemons: [mon.a, mon.b, mon.c, osd.0, osd.1, mds.a]
- print: "**** done restart all" 
- workunit:
    branch: firefly
    clients:
      client.0:
      - rbd/test_librbd_python.sh
- print: "**** done rbd/test_librbd_python.sh"
- workunit:
    branch: dumpling
    clients:
      client.0:
      - rados/test-upgrade-firefly.sh
      - cls
- print: "**** done rados/test-upgrade-firefly.sh &  cls" 
- workunit:
    branch: firefly
    clients:
      client.0:
        - rbd/import_export.sh
    env:
      RBD_CREATE_ARGS: --new-format
- print: "**** done rbd/import_export.sh"
- workunit:
    branch: firefly
    clients:
      client.0:
        - cls/test_cls_rbd.sh
- print: "**** done cls/test_cls_rbd.sh"
- rgw: [client.0]
- s3tests:
    client.0:
      force-branch: firefly-original
      rgw_server: client.0
- print: "**** done s3tests"
