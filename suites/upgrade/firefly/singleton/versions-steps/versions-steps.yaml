overrides:
  ceph:
    log-whitelist:
    - scrub
    - osd_map_max_advance
    fs: xfs
    conf:
      osd:
        osd map max advance: 1000
roles:
- - mon.a
  - mds.a
  - osd.0
  - osd.1
  - osd.2
- - mon.b
  - mon.c
  - osd.3
  - osd.4
  - osd.5
  - client.0
- - client.1
tasks:
- install:
    tag: v0.80.4
- print: "**** done v0.80.4 install"
- ceph:
   fs: xfs
- print: "**** done ceph xfs"
- sequential:
   - workload
- print: "**** done workload v0.80.4"
- parallel:
   - workload1
   - upgrade-sequence1
- print: "**** done parallel v0.80.5"
- parallel:
   - workload2
   - upgrade-sequence2
- print: "**** done parallel v0.80.7"
- parallel:
   - workload3
   - upgrade-sequence3
- print: "**** done parallel v0.80.8"
- parallel:
   - workload4
   - upgrade-sequence4
- print: "**** done parallel v0.80.9"
- parallel:
   - workload_firefly
   - upgrade-sequence_firefly
- print: "**** done parallel firefly branch"
#######################
workload:
   sequential:
   - workunit:
       clients:
         client.0:
           - suites/blogbench.sh
   - print: "**** done suites/blogbench.sh workload"
workload1:
   sequential:
   - workunit:
       clients:
         client.0:
         - rados/load-gen-big.sh
   - print: "**** done rados/load-gen-big.sh workload1"
   - workunit:
       clients:
         client.0:
         - rados/test.sh
         - cls
   - print: "**** done rados/test.sh &  cls workload1"
   - workunit:
       clients:
         client.0:
         - rbd/test_librbd.sh
   - print: "**** done rbd/test_librbd.sh workload1"
upgrade-sequence1:
   sequential:
   - install.upgrade:
       mon.a:
         tag: v0.80.5
       mon.b:
         tag: v0.80.5
       client.1:
         tag: v0.80.5
   - print: "**** done v0.80.5 install.upgrade"
   - ceph.restart: [mon.a]
   - sleep:
       duration: 60
   - ceph.restart: [mon.b]
   - sleep:
       duration: 60
   - ceph.restart: [mon.c]
   - sleep:
       duration: 60
   - ceph.restart: [mds.a]
   - sleep:
       duration: 60
   - ceph.restart: [osd.0]
   - sleep:
       duration: 30
   - ceph.restart: [osd.1]
   - sleep:
       duration: 30
   - ceph.restart: [osd.2]
   - sleep:
       duration: 30
   - ceph.restart: [osd.3]
   - sleep:
       duration: 30
   - ceph.restart: [osd.4]
   - sleep:
       duration: 30
   - ceph.restart: [osd.5]
   - sleep:
       duration: 30
   - print: "**** done ceph.restart all 1 mon/mds/osd"
workload2:
   sequential:
#   removed to fix #10176
#   - workunit:
#       clients:
#         client.0:
#           - rbd/import_export.sh
#       env:
#         RBD_CREATE_ARGS: --new-format
   - workunit:
       clients:
         client.0:
           - cls/test_cls_rbd.sh
   - print: "**** done cls/test_cls_rbd.sh workload2"
upgrade-sequence2:
   sequential:
   - install.upgrade:
       mon.a:
         tag: v0.80.7
       mon.b:
         tag: v0.80.7
       client.1:
         tag: v0.80.7
   - print: "**** done v0.80.7 install.upgrade"
   - ceph.restart: [osd.0]
   - sleep:
       duration: 30
   - ceph.restart: [osd.1]
   - sleep:
       duration: 30
   - ceph.restart: [osd.2]
   - sleep:
       duration: 30
   - ceph.restart: [osd.3]
   - sleep:
       duration: 30
   - ceph.restart: [osd.4]
   - sleep:
       duration: 30
   - ceph.restart: [osd.5]
   - sleep:
       duration: 60
   - ceph.restart: [mon.a]
   - sleep:
       duration: 60
   - ceph.restart: [mon.b]
   - sleep:
       duration: 60
   - ceph.restart: [mon.c]
   - sleep:
       duration: 60
   - ceph.restart: [mds.a]
   - sleep:
       duration: 60
   - print: "**** done ceph.restart all 2 osd/mon/mds"
workload3:
   sequential:
   - workunit:
       clients:
         client.0:
         - rados/load-gen-big.sh
   - print: "**** done rados/load-gen-big.sh workload3"
   - workunit:
       clients:
         client.0:
         - rados/test.sh
         - cls
   - print: "**** done rados/test.sh &  cls workload3"
   - workunit:
       clients:
         client.0:
         - rbd/test_librbd.sh
   - print: "**** done rbd/test_librbd.sh workload3"
upgrade-sequence3:
   sequential:
   - install.upgrade:
       mon.a:
         tag: v0.80.8
       mon.b:
         tag: v0.80.8
       client.1:
         tag: v0.80.8
   - print: "**** done v0.80.8 install.upgrade"
   - ceph.restart: [mon.a]
   - sleep:
       duration: 60
   - ceph.restart: [mon.b]
   - sleep:
       duration: 60
   - ceph.restart: [mon.c]
   - sleep:
       duration: 60
   - ceph.restart: [mds.a]
   - sleep:
       duration: 60
   - ceph.restart: [osd.0]
   - sleep:
       duration: 30
   - ceph.restart: [osd.1]
   - sleep:
       duration: 30
   - ceph.restart: [osd.2]
   - sleep:
       duration: 30
   - ceph.restart: [osd.3]
   - sleep:
       duration: 30
   - ceph.restart: [osd.4]
   - sleep:
       duration: 30
   - ceph.restart: [osd.5]
   - sleep:
       duration: 30
   - print: "**** done ceph.restart all  mon/mds/osd upgrade-sequence3"
workload4:
   sequential:
   - workunit:
       clients:
         client.0:
         - rados/load-gen-big.sh
   - print: "**** done rados/load-gen-big.sh workload4"
   - workunit:
       clients:
         client.0:
         - rados/test.sh
         - cls
   - print: "**** done rados/test.sh &  cls workload4"
   - workunit:
       clients:
         client.0:
         - rbd/test_librbd.sh
   - print: "**** done rbd/test_librbd.sh workload4"
upgrade-sequence4:
   sequential:
   - install.upgrade:
       mon.a:
         tag: v0.80.9
       mon.b:
         tag: v0.80.9
       client.1:
         tag: v0.80.9
   - print: "**** done v0.80.9 install.upgrade"
   - ceph.restart: [mon.a]
   - sleep:
       duration: 60
   - ceph.restart: [mon.b]
   - sleep:
       duration: 60
   - ceph.restart: [mon.c]
   - sleep:
       duration: 60
   - ceph.restart: [mds.a]
   - sleep:
       duration: 60
   - ceph.restart: [osd.0]
   - sleep:
       duration: 30
   - ceph.restart: [osd.1]
   - sleep:
       duration: 30
   - ceph.restart: [osd.2]
   - sleep:
       duration: 30
   - ceph.restart: [osd.3]
   - sleep:
       duration: 30
   - ceph.restart: [osd.4]
   - sleep:
       duration: 30
   - ceph.restart: [osd.5]
   - sleep:
       duration: 30
   - print: "**** done ceph.restart all 1 mon/mds/osd upgrade-sequence4"
workload_firefly:
   sequential:
   - rgw: [client.0]
   - print: "**** done rgw workload_firefly"
   - s3tests:
       client.0:
         force-branch: firefly-original
         rgw_server: client.0
   - print: "**** done s3tests workload_firefly"
upgrade-sequence_firefly:
   sequential:
   - install.upgrade:
       mon.a:
         branch: firefly
       mon.b:
         branch: firefly
       client.1:
         branch: firefly
   - print: "**** done branch: firefly install.upgrade"
   - ceph.restart: [mds.a]
   - sleep:
       duration: 60
   - ceph.restart: [osd.0]
   - sleep:
       duration: 30
   - ceph.restart: [osd.1]
   - sleep:
       duration: 30
   - ceph.restart: [osd.2]
   - sleep:
       duration: 30
   - ceph.restart: [osd.3]
   - sleep:
       duration: 30
   - ceph.restart: [osd.4]
   - sleep:
       duration: 30
   - ceph.restart: [osd.5]
   - sleep:
       duration: 60
   - ceph.restart: [mon.a]
   - sleep:
       duration: 60
   - ceph.restart: [mon.b]
   - sleep:
       duration: 60
   - ceph.restart: [mon.c]
   - sleep:
       duration: 60
   - print: "**** done ceph.restart all firefly current branch mds/osd/mon"
